Blob-aware LinguaPlone content
==============================

This test tries to make sure blob-based, multi-lingual content can be
properly created and edited.


Creation
--------

Before we can start creating a content item we need to set the supported
languages to more than one, so creation of copies for multi-language content
can be testet:

  >>> self.setRoles('Manager')
  >>> browser = self.getBrowser()
  >>> browser.open(portal.absolute_url())
  >>> browser.getLink('Site Setup').click()
  >>> browser.getLink('Language').click()
  >>> browser.getControl('Available languages').displayValue = ['English', 'German']
  >>> browser.getControl('Save').click()

Now we can try to create an instance of the multi-lingual, file-like
sample type:

  >>> browser.open(self.folder.absolute_url())
  >>> browser.getLink(url='createObject?type_name=BlobelFish').click()
  >>> browser.url
  'http://nohost/plone/.../portal_factory/BlobelFish/blobelfish.../edit'
  >>> browser.getControl(name='title').value = 'Flobby'

  >>> from plone.app.blob.tests.utils import getFile
  >>> control = browser.getControl(name='guide_file')
  >>> control.filename = 'guide.pdf'
  >>> control.value = getFile('plone.pdf')
  >>> browser.getControl('Save').click()

Let's check the default view:

  >>> browser.url
  'http://nohost/plone/.../flobby/...'
  >>> browser.contents
  '...Info...Changes saved...
   ...Flobby...
   ...guide.pdf...PDF document,...28Kb...'

Next we add a translation and check it:

  >>> browser.getLink(url='@@translate?newlanguage=de').click()
  >>> browser.getControl('Title').value = 'Flubbie'
  >>> browser.handleErrors = False
  >>> browser.getControl('Save').click()
  >>> browser.url
  'http://nohost/plone/.../flubbie/...'
  >>> browser.contents
  '...Info...Changes saved...
   ...Flubbie...
   ...guide.pdf...PDF document,...28Kb...'

We also check if the two items are using the same underlying ZODB blob for
storing the PDF data.  This should be the case, since the field was marked
to be language-independent:

  >>> flobby = self.folder.flobby
  >>> flubbie = self.folder.flubbie
  >>> flobby.getGuide().getBlob() is flubbie.getGuide().getBlob()
  True

